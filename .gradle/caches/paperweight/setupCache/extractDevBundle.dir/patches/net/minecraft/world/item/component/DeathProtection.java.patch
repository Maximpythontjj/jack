--- a/net/minecraft/world/item/component/DeathProtection.java
+++ b/net/minecraft/world/item/component/DeathProtection.java
@@ -2,6 +2,7 @@
 
 import com.mojang.serialization.Codec;
 import com.mojang.serialization.codecs.RecordCodecBuilder;
+import java.util.Iterator;
 import java.util.List;
 import net.minecraft.network.RegistryFriendlyByteBuf;
 import net.minecraft.network.codec.ByteBufCodecs;
@@ -14,30 +15,26 @@
 import net.minecraft.world.item.consume_effects.ClearAllStatusEffectsConsumeEffect;
 import net.minecraft.world.item.consume_effects.ConsumeEffect;
 
+// CraftBukkit start
+import org.bukkit.event.entity.EntityPotionEffectEvent;
+// CraftBukkit end
+
 public record DeathProtection(List<ConsumeEffect> deathEffects) {
-    public static final Codec<DeathProtection> CODEC = RecordCodecBuilder.create(
-        instance -> instance.group(ConsumeEffect.CODEC.listOf().optionalFieldOf("death_effects", List.of()).forGetter(DeathProtection::deathEffects))
-                .apply(instance, DeathProtection::new)
-    );
-    public static final StreamCodec<RegistryFriendlyByteBuf, DeathProtection> STREAM_CODEC = StreamCodec.composite(
-        ConsumeEffect.STREAM_CODEC.apply(ByteBufCodecs.list()), DeathProtection::deathEffects, DeathProtection::new
-    );
-    public static final DeathProtection TOTEM_OF_UNDYING = new DeathProtection(
-        List.of(
-            new ClearAllStatusEffectsConsumeEffect(),
-            new ApplyStatusEffectsConsumeEffect(
-                List.of(
-                    new MobEffectInstance(MobEffects.REGENERATION, 900, 1),
-                    new MobEffectInstance(MobEffects.ABSORPTION, 100, 1),
-                    new MobEffectInstance(MobEffects.FIRE_RESISTANCE, 800, 0)
-                )
-            )
-        )
-    );
+
+    public static final Codec<DeathProtection> CODEC = RecordCodecBuilder.create((instance) -> {
+        return instance.group(ConsumeEffect.CODEC.listOf().optionalFieldOf("death_effects", List.of()).forGetter(DeathProtection::deathEffects)).apply(instance, DeathProtection::new);
+    });
+    public static final StreamCodec<RegistryFriendlyByteBuf, DeathProtection> STREAM_CODEC = StreamCodec.composite(ConsumeEffect.STREAM_CODEC.apply(ByteBufCodecs.list()), DeathProtection::deathEffects, DeathProtection::new);
+    public static final DeathProtection TOTEM_OF_UNDYING = new DeathProtection(List.of(new ClearAllStatusEffectsConsumeEffect(), new ApplyStatusEffectsConsumeEffect(List.of(new MobEffectInstance(MobEffects.REGENERATION, 900, 1), new MobEffectInstance(MobEffects.ABSORPTION, 100, 1), new MobEffectInstance(MobEffects.FIRE_RESISTANCE, 800, 0)))));
 
     public void applyEffects(ItemStack stack, LivingEntity entity) {
-        for (ConsumeEffect consumeEffect : this.deathEffects) {
-            consumeEffect.apply(entity.level(), stack, entity);
+        Iterator iterator = this.deathEffects.iterator();
+
+        while (iterator.hasNext()) {
+            ConsumeEffect consumeeffect = (ConsumeEffect) iterator.next();
+
+            consumeeffect.apply(entity.level(), stack, entity, EntityPotionEffectEvent.Cause.TOTEM); // CraftBukkit
         }
+
     }
 }
